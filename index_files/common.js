"use strict";var $com=function(){String.format=function(){var e=arguments[0];if("string"==typeof e)for(var n,t=arguments.length,i=1;i<t;i++)n=new RegExp("\\{"+(i-1)+"\\}","g"),e=e.replace(n,arguments[i]);else e="";return e},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var e=function(){if(!noty)return null;var e={theme:"relax",type:"information",timeout:3e3,layout:"top",modal:!1,maxVisible:100},n=function(n,t){return noty($.extend({text:n},e,t))};return{show:n,ok:function(e,t){var i={type:"success"};return n(e,$.extend(i,t))},error:function(e,t){var i={type:"error",timeout:!1};return e+="<br/>【点击关闭该提示】",n(e,$.extend(i,t))},warn:function(e,t){var i={type:"warning"};return n(e,$.extend(i,t))},confirm:function(e,t,i){var r={type:"warning",layout:"center",modal:!0,timeout:!1,buttons:[{addClass:"btn btn-info",text:"确认",onClick:t},{addClass:"btn",text:"取消",onClick:function(e){e.close()}}]};return n(e,$.extend(r,i))},closeAll:function(){$.noty.clearQueue(),$.noty.closeAll()},showVipWizard:function(e){return e=e||"该功能限定VIP用户可以使用，您当前无法使用该功能，请先成为vip客户后再使用该功能。",e+="<br/><br/><a href='/manage/vip/pay' target='_blank' class='btn btn-info'>点此成为vip客户</a>",this.confirm(e,null,{buttons:[{addClass:"btn",text:"残忍拒绝",onClick:function(e){e.close()}}]})}}}(),n=function(){var n={},t=function(t,i){i&&(t=t||"wannengye",$.getJSON("/manage/utils/getUploadToken",{bucket:t}).done(function(t){t.key?(n.uploadToken=t.value,i.call(this,n.uploadToken)):e.error("上传组件初始化错误："+t.value)}))},i=function(n,i){t(i.bucket,function(t){n.append("token",t),NProgress.start(),$.ajax({url:"http://upload.qiniu.com",type:"POST",data:n,dataType:"json",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&NProgress.inc()},!1),e},cache:!1,contentType:!1,processData:!1}).done(function(n){return n.error?void e.error("上传失败,错误原因:"+n.error):(i.callback&&i.callback.call(this,n,i),void NProgress.done())})})},r=function(n){n=n||{};var t=$(n.trigger);if(0!==t.length){var r=$.extend(!0,{bucket:"wannengye",prefix:"",form:$("<form/>",{enctype:"multipart/form-data"}),file:$("<input/>",{name:"file",type:"file"})},n,{trigger:t});return r.file.appendTo(r.form),r.trigger.on("click",function(e){r.accept&&r.file.prop("accept",r.accept),r.currentTrigger=$(this),r.file.trigger("click")}),r.file.on("change",function(n){if(!(this.files.length<1)){var t=this.files[0];if(t.size>r.size)return void e.error("上传文件大小不得超过"+r.size/1024/1e3+"mb,当前文件大小为"+(t.size/1024/1e3).toFixed(2)+"mb");if(r.suffixs.indexOf(t.name.toLowerCase().substring(t.name.lastIndexOf(".")))===-1)return void e.error("上传文件类型错误，允许类型为:"+r.suffixs);var o=new FormData(r.form[0]);i(o,r)}}),r}},o=function(e,n){if(e){var t=new FormData;t.append("file",e),i(t,n)}};return{init:r,upload:o}}(),t=function(){var e={log:function(e){return console.log(e),e},buildClassName:function(e,n){return e+" "+n}},n={logIn:function(e){return console.log("in",e),e},logOut:function(e){return console.log("out",e),e},validIntIn:function(e){if(0===e)return""},validIntOut:function(e){var n=parseInt(e);return isNaN(n)?(this.linkCtx.elem.value=0,0):n},validDatetimeIn:function(e){return""===e?e:moment(new Date(e)).isValid()?e:""},validDatetimeOut:function(e){return""===e?e:moment(new Date(e)).isValid()?e:(this.linkCtx.elem.value="","")}},t={range:{baseTag:"for",render:function(e){var n=e,t=this.tagCtx.props.start||0,i=this.tagCtx.props.end;if(t||i)if(this.tagCtx.args.length)$.isArray(n)&&(n=n.slice(t,i));else{n=[],i=i||0;for(var r=t;r<=i;r++)n.push(r)}return this.base(n)},onArrayChange:function(e,n){this.refresh()}}};return{initHelper:function(n){$.views.helpers($.extend({},e,n))},initConverter:function(e){$.views.converters($.extend({},n,e))},initTag:function(e){$.views.tags($.extend({},t,e))}}}(),i=function(){var e={render:"image",size:100,ecLevel:"H",radius:.3,color:"#3a3",mSize:.2,mPosX:.5,mPosY:.5,mode:0},n=function(n,t,i){var r=$.extend({text:t},e,i);n.qrcode(r)};return{init:n}}(),r=function(){return{draw:function(e,n){if("undefined"==typeof Qrcodesvg)return void console.error("Qrcodesvg is undefined!");$("#"+e).html("");var t=new Qrcodesvg(n,e,250);t.draw()},download:function(e,n){var t=e.html(),i=new Image;i.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(t)));var r=$("<a>",{rel:"nofollow",href:i.src,download:n});r[0].click()}}}(),o=function(){$.fn.getHexBackgroundColor=function(){var e=$(this).css("background-color");if(!$.browser.msie){var n=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),e="#"+n(e[1])+n(e[2])+n(e[3])}return e}},a=function(){var e,n,t,i,r,o,a,u,s,d=navigator.userAgent;if(d.indexOf("Macintosh")>0)e="mac",n="mac",i="OS X ",r=")",s="pc";else if(d.indexOf("Windows phone")>0)e="windows",n="windows phone",i="Windows Phone OS ",r=" ",s="mobile";else if(d.indexOf("Windows")>0)switch(e="windows",n="windows",i="Windows NT ",r=" ",s="pc",o=d.substring(d.indexOf(i)+i.length),t=o.substring(0,o.indexOf(";")),""==t&&(t=o.substring(0,o.indexOf(")"))),t){case"10.0":t="Windows 10";break;case"6.2":case"6.3":case"6.4":t="windows 8";break;case"6.1":t="windows 7";break;case"6.0":t="windowsV ista";break;case"5.2":t="windows 2003";break;case"5.1":t="windows XP";break;case"5.0":t="windows 2000"}else d.indexOf("iPhone")>0||d.indexOf("iPad")>0||d.indexOf("iPod")>0?(e="iOS",d.indexOf("iPhone")>0?(s="mobile",n="iPhone"):d.indexOf("iPad")>0?(n="iPad",s="tablet"):d.indexOf("iPod")>0&&(n="iPod",s="mobile"),i=" OS ",r=" "):d.indexOf("Android")>0?(e="android",n="android",i="Android ",r=";",s=d.indexOf("Mobile")>0?"mobile":"tablet"):(e="-",n="-",t="-",s="-");return"windows"!==n&&"-"!==n&&(o=d.substring(d.indexOf(i)+i.length),t=o.substring(0,o.indexOf(r))),r=" ",d.indexOf("MicroMessenger")>0?(a="weixin",i="MicroMessenger/"):d.indexOf("Weibo")>0?(a="weibo",i="weibo__",r="__"):d.indexOf("QQ")>0&&d.indexOf("NetType")>0?(a="qq",i="QQ/"):d.indexOf("UBrowser")>0?(a="UBrowser",i="UBrowser/"):d.indexOf("MQQBrowser")>0?(a="QQBrowser",i="MQQBrowser/"):d.indexOf("SogouMobileBrowser")>0?(a="SogouMobileBrowser",i="SogouMobileBrowser/"):d.indexOf("BIDUBrowser")>0?(a="baidu",i="BIDUBrowser/"):d.indexOf(" SE ")>0?(a="sogou",i=null):d.indexOf("LBBROWSER")>0?(a="liebao",i="Chrome/"):d.indexOf("Maxthon")>0?(a="Maxthon",i="Maxthon/"):d.indexOf("The World")>0?(a="The World",i=null):d.indexOf("TencentTraveler")>0?(a="tt",i="TencentTraveler/"):d.indexOf("Safari")>0&&d.indexOf("Version")>0?(a="safari",i="Version/"):d.indexOf("Chrome")>0?(a="chrome",i="Chrome/"):d.indexOf("Firefox")>0?(a="firefox",i="Firefox/"):d.indexOf("Opera")>-1?(a="opera",i=" Version/"):d.indexOf("MSIE")>0?(a="ie",i="MSIE "):d.indexOf("Trident")>0&&d.indexOf("rv:")>0?(a="ie",i="rv:",r=")"):d.indexOf("Mercury")>0?(a="mercury",i="Mercury/"):(a="unknow",u="-"),null==i&&(u="-"),"unknow"!==a&&null!==i&&(o=d.substring(d.indexOf(i)+i.length),u=o.substring(0,o.indexOf(r))),{ua:d,platform:s,os:e,device:n,deviceVersion:t,browser:a,browserVersion:u}}();return{noty:e,jsviews:t,qiniuUpload:n,qr:i,qrsvg:r,extendQuery:o,uaDetector:a,dateUtils:{convertString2Datetime:function(e){return""!==e&&moment(new Date(e)).isValid()?moment(e).valueOf():moment("1970-1-1","YYYY-MM-dd").valueOf()},convertDatetime2String:function(e){var n=moment(e);return n.year()<1971?"":n.format("YYYY-MM-DD HH:mm")}},setObjectAttrByNamePath:function(e,n,t){var i=n.split(".");return 1===i.length?void(e[i[0]]=t):void this.setObjectAttrByNamePath(e[i[0]],i.slice(1).join("."),t)},stopPop:function(e){e.stopPropagation(),e.preventDefault()},saveImage2Gallery:function(e,n){$.post("/manage/utils/saveImage2Gallery",{fileName:e,hash:n},function(e){},"json")},validate:{isTel:function(e){var n=/^\d{3,4}[-_－—]\d{7,8}([-_－—#]\d{3,})?$/;return n.test($.trim(e))},isMobile:function(e){var n=/^1[3|4|5|7|8]\d{9}$/;return n.test($.trim(e))},isEmail:function(e){var n=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return n.test($.trim(e))},isWebsite:function(e){var n=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return n.test($.trim(e))},isQQ:function(e){var n=/^\d{5,11}$/;return n.test($.trim(e))}},shareCommon:{buildQQShareCode:function(e,n){var t="【"+e+"】(分享自@万能页)",i=encodeURI(n+"&desc="+t+"&title="+e+"&showcount=0&site=万能页&style=203&width=98&height=22"),r="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i;return r},buildWeiboShareCode:function(e,n){return"javascript:void((function(){var title = '#我的页面我做主#【"+e+"】(分享自@万能页)', href ='"+n+"';var api = 'http://v.t.sina.com.cn/share/share.php?appkey=3466271911' + '&title=' + encodeURIComponent(title) + '&url=' + encodeURIComponent(href) + '&searchPic=true&content=' + (document.charset || 'gbk'); window.open(api, '_blank');return ;})())"},initCopyByZclip:function(n,t){n.zclip({path:"/statics/js/zclip-1.1.5/ZeroClipboard.swf",copy:t,afterCopy:function(){e.ok("复制链接成功,Ctrl+V 粘贴,您也可以手动复制本页面地址 : "+t)}})},initCopyByClipboard:function(n,t){var i=new Clipboard(n,t);return i.on("success",function(n){return n.clearSelection(),t&&t.success_callback?void t.success_callback.call(this,n):void e.ok("复制成功, 您可以使用Ctrl+V 或 Cmd+V 进行粘贴, 复制内容: "+n.text)}),i.on("error",function(n){e.error("复制失败, 当前浏览器不支持复制功能, 请手动复制内容: "+i.text())}),i}},getQueryString:function(e,n){n=n||window.location.search;var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");0===n.indexOf("?")&&(n=n.substr(1));var i=n.match(t);if(i)return unescape(i[2])},debounce:function(e,n,t){var i;return function(){var r=this,o=arguments,a=function(){i=null,t||e.apply(r,o)},u=t&&!i;clearTimeout(i),i=setTimeout(a,n),u&&e.apply(r,o)}}}}();